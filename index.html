<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Jogo do Juiz ‚Äî Vale Produ√ß√£o</title>

  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body, #root {
      height: 100%;
    }
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ------------ HOOK: M√ÅQUINA DE ESCREVER ------------
    function useTypewriter(fullText, speed = 18) {
      const [text, setText] = useState("");
      useEffect(() => {
        if (!fullText) {
          setText("");
          return;
        }
        setText("");
        let i = 0;
        const id = setInterval(() => {
          i++;
          setText(fullText.slice(0, i));
          if (i >= fullText.length) clearInterval(id);
        }, speed);
        return () => clearInterval(id);
      }, [fullText, speed]);
      return text;
    }

    // ------------ DADOS FIXOS ------------
    const ESTADOS = {
      "AC":["Rio Branco"],"AL":["Macei√≥"],"AP":["Macap√°"],"AM":["Manaus"],
      "BA":["Salvador","Feira de Santana","Vit√≥ria da Conquista"],
      "CE":["Fortaleza"],"DF":["Bras√≠lia"],"ES":["Vit√≥ria"],"GO":["Goi√¢nia"],
      "MA":["S√£o Lu√≠s"],"MT":["Cuiab√°"],"MS":["Campo Grande"],
      "MG":["Belo Horizonte","Uberl√¢ndia","Juiz de Fora"],
      "PA":["Bel√©m"],"PB":["Jo√£o Pessoa"],"PR":["Curitiba","Londrina"],
      "PE":["Recife"],"PI":["Teresina"],"RJ":["Rio de Janeiro","Niter√≥i"],
      "RN":["Natal"],"RS":["Porto Alegre","Caxias do Sul"],
      "RO":["Porto Velho"],"RR":["Boa Vista"],
      "SC":["Florian√≥polis","Joinville"],
      "SP":["S√£o Paulo","Campinas","Santos","Sorocaba"],
      "SE":["Aracaju"],"TO":["Palmas"]
    };

    const SOUND_URLS = {
      gavel:"https://cdn.pixabay.com/download/audio/2022/03/15/audio_b8e7f6b3a0.mp3?filename=judge-gavel-182004.mp3",
      murmur:"https://cdn.pixabay.com/download/audio/2021/09/16/audio_7b4b2d7f6c.mp3?filename=crowd-murmur-ambient-75537.mp3"
    };

    function useSound(url, enabled=true, volume=0.7){
      const ref = useRef(null);
      useEffect(()=>{
        const a = new Audio(url);
        a.volume = volume;
        ref.current = a;
        return ()=>{ a.pause(); ref.current = null; };
      },[url]);
      const play = ()=>{ if(enabled && ref.current){ ref.current.currentTime = 0; ref.current.play(); } };
      return { play };
    }

    // ------------ CASOS (variados) ------------
    function seedCases(){
      const casos = [];
      let id = 1;

      function addLote(tipo, titulo, resumo, gabarito, dificuldade){
        for(let i=0;i<8;i++){
          casos.push({
            id: tipo+"-"+id++,
            tipo,
            titulo: titulo+" ("+dificuldade+") #"+(i+1),
            resumo,
            gabarito,
            dificuldade,
            provas: [
              {id:"E1",tipo:"boletim",conteudo:"Registro oficial do fato com hor√°rio, local e partes envolvidas, lavrado pela autoridade competente."},
              {id:"E2",tipo:"laudo",conteudo:"Laudo t√©cnico descrevendo danos, les√µes ou situa√ß√£o periciada, com metodologia e conclus√£o."},
              {id:"E3",tipo:"testemunha",conteudo:"Depoimento com pontos de concord√¢ncia e diverg√™ncia entre a vers√£o da v√≠tima e do acusado."}
            ],
            status:"na_fila"
          });
        }
      }

      // Criminal
      addLote("criminal","Furto simples em com√©rcio",
        "Subtra√ß√£o de bem em com√©rcio sem viol√™ncia ou grave amea√ßa, captado por c√¢meras de seguran√ßa.",
        {culpado:true},"f√°cil"
      );
      addLote("criminal","Roubo em via p√∫blica",
        "Apropria√ß√£o de bens com grave amea√ßa ou viol√™ncia, em via p√∫blica, com reconhecimento da v√≠tima.",
        {culpado:true},"m√©dio"
      );
      addLote("criminal","Les√£o corporal em contexto dom√©stico",
        "Conflito familiar com alega√ß√£o de agress√µes f√≠sicas, vers√£o divergente entre as partes, medida protetiva pr√©via.",
        {culpado:true},"m√©dio"
      );
      addLote("criminal","Homic√≠dio em briga de bar",
        "Discuss√£o em estabelecimento que evolui para agress√£o grave com resultado morte, alega√ß√£o de leg√≠tima defesa.",
        {culpado:true},"dif√≠cil"
      );

      // Fam√≠lia
      addLote("familia","Revis√£o de alimentos",
        "Pedido de altera√ß√£o do valor de pens√£o aliment√≠cia por mudan√ßa de renda, com alega√ß√£o de desemprego e renda informal.",
        {culpado:false},"m√©dio"
      );
      addLote("familia","Guarda compartilhada",
        "Defini√ß√£o de resid√™ncia principal de menor e regime de conviv√™ncia, ambos os genitores aptos segundo relat√≥rio psicossocial.",
        {culpado:false},"m√©dio"
      );
      addLote("familia","Aliena√ß√£o parental",
        "Alega√ß√µes de interfer√™ncia na forma√ß√£o psicol√≥gica da crian√ßa, mensagens conflitantes e relatos de profissionais.",
        {culpado:true},"dif√≠cil"
      );
      addLote("familia","Medida protetiva",
        "Pedido de prote√ß√£o diante de relatos de viol√™ncia psicol√≥gica e amea√ßas, com hist√≥rico de boletins de ocorr√™ncia.",
        {culpado:true},"dif√≠cil"
      );

      // Trabalhista
      addLote("trabalhista","Horas extras habituais",
        "Discuss√£o sobre jornada al√©m do contrato e correto pagamento de horas extras, cart√µes de ponto com inconsist√™ncias.",
        {culpado:false},"m√©dio"
      );
      addLote("trabalhista","V√≠nculo de emprego x PJ",
        "Reconhecimento ou n√£o de v√≠nculo empregat√≠cio em contrato PJ, com subordina√ß√£o e exclusividade.",
        {culpado:true},"dif√≠cil"
      );
      addLote("trabalhista","Adicional de insalubridade",
        "Trabalho em ambiente potencialmente insalubre, per√≠cia aponta exposi√ß√£o intermitente a agentes nocivos.",
        {culpado:true},"m√©dio"
      );
      addLote("trabalhista","Ass√©dio moral no trabalho",
        "Relatos de humilha√ß√µes p√∫blicas, xingamentos e cobran√ßas excessivas em grupo de mensagens corporativas.",
        {culpado:true},"dif√≠cil"
      );

      return casos;
    }

    // ------------ IA SIMULADA (usa provas e pergunta) ------------
    async function iaFala(agente, caso, pergunta=""){
      const resumo = caso.resumo;
      const provasTexto = caso.provas
        .map(p => `[${p.id}] ${p.tipo}: ${p.conteudo}`)
        .join(" ");

      const prefixo =
        agente==="acusacao" ? "ACUSA√á√ÉO: " :
        agente==="defesa" ? "DEFESA: " :
        "RESPOSTA: ";

      const foco = pergunta
        ? "Respondendo diretamente √† pergunta do Juiz: \""+pergunta+"\". "
        : "Organizando os principais elementos constantes dos autos. ";

      let abordagem = "";

      if(agente==="acusacao"){
        abordagem =
          "A acusa√ß√£o destaca os elementos que refor√ßam a responsabiliza√ß√£o do acusado, " +
          "considerando o padr√£o probat√≥rio aplic√°vel ao tipo de causa. ";
      }else if(agente==="defesa"){
        abordagem =
          "A defesa enfatiza as lacunas, contradi√ß√µes e a necessidade de preservar o princ√≠pio da d√∫vida razo√°vel, " +
          "bem como os direitos e garantias fundamentais do acusado. ";
      }else{
        abordagem =
          "A resposta busca esclarecer os pontos f√°ticos relevantes, sem substituir a convic√ß√£o do Juiz, " +
          "mas oferecendo um panorama coerente das provas produzidas. ";
      }

      const usoProvas =
        "Provas relevantes: " + provasTexto +
        " A partir desses elementos, √© poss√≠vel construir uma linha argumentativa consistente, " +
        "observando a coer√™ncia entre depoimentos, documentos e laudos.";

      const texto = prefixo + foco + abordagem + "Resumo do caso: " + resumo + " " + usoProvas;

      await new Promise(r=>setTimeout(r,300));
      return texto;
    }

    // ------------ TELAS ------------
    function SplashScreen({onStart}){
      return (
        <div className="min-h-screen flex items-center justify-center bg-black">
          <div className="relative w-full max-w-md h-[520px] rounded-3xl overflow-hidden shadow-2xl">
            <div className="absolute inset-0 bg-[url('capa.jpg')] bg-cover bg-center" />
            <div className="absolute inset-0 bg-gradient-to-t from-black via-black/70 to-transparent" />
            <div className="relative z-10 h-full flex flex-col items-center justify-end pb-10 px-6">
              <h1 className="text-3xl font-bold mb-1 drop-shadow-lg text-center">Jogo do Juiz</h1>
              <p className="text-sm opacity-90 mb-4 text-center">Vale Produ√ß√£o ‚Ä¢ Simulador Educacional</p>
              <button
                onClick={onStart}
                className="px-6 py-3 rounded-2xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold shadow-xl"
              >
                Iniciar
              </button>
            </div>
          </div>
        </div>
      );
    }

    function TutorialSalvamento({onContinuar}){
      return (
        <div className="min-h-screen flex items-center justify-center bg-gradient-to-b from-slate-950 via-slate-900 to-black text-white">
          <div className="max-w-xl w-full mx-4 p-6 rounded-3xl bg-white/5 border border-white/10 backdrop-blur">
            <h2 className="text-2xl font-bold mb-3">Como o jogo salva seu progresso</h2>
            <ol className="list-decimal pl-5 space-y-2 text-sm">
              <li>O jogo grava automaticamente sua carreira no pr√≥prio navegador (localStorage).</li>
              <li>Voc√™ pode exportar um arquivo de backup (.json) pela tela de login.</li>
              <li>Depois, pode importar esse arquivo em outro dispositivo e continuar de onde parou.</li>
            </ol>
            <p className="mt-4 text-xs opacity-80">
              Dica: use um nome de usu√°rio fixo (ex.: <b>DraMaria</b>) para manter sua carreira organizada.
            </p>
            <button
              onClick={onContinuar}
              className="mt-5 px-5 py-2 rounded-2xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold"
            >
              Entendi, ir para o login
            </button>
          </div>
        </div>
      );
    }

    function LoginScreen({profiles,setProfiles,setCurrentProfile,onEnter}){
      const [user,setUser] = useState("");
      const [file,setFile] = useState(null);

      function handleEnter(){
        if(!user.trim()) return;
        if(!profiles[user]){
          const novo = {
            nome:user.trim(),
            court:null,
            estado:"SP",
            cidade:"S√£o Paulo",
            stats:{julgados:0,acertos:0,prestigio:0}
          };
          const updated = {...profiles,[user]:novo};
          setProfiles(updated);
          localStorage.setItem("juiz_profiles",JSON.stringify(updated));
        }
        setCurrentProfile(user.trim());
        onEnter();
      }

      function handleExport(){
        const blob = new Blob([JSON.stringify(profiles,null,2)],{type:"application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "jogo-do-juiz-save.json";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      function handleImport(){
        if(!file) return;
        const reader = new FileReader();
        reader.onload = e=>{
          try{
            const data = JSON.parse(e.target.result);
            setProfiles(data);
            localStorage.setItem("juiz_profiles",JSON.stringify(data));
            alert("Save importado com sucesso!");
          }catch(err){
            alert("Arquivo inv√°lido.");
          }
        };
        reader.readAsText(file);
      }

      return (
        <div className="min-h-screen bg-[url('capa.jpg')] bg-cover bg-center flex items-center justify-center">
          <div className="bg-black/75 text-white max-w-lg w-full mx-4 p-6 rounded-3xl border border-white/10 backdrop-blur">
            <h1 className="text-xl font-semibold mb-1 text-center">Vale Produ√ß√£o apresenta</h1>
            <h2 className="text-3xl font-bold text-center mb-4">Jogo do Juiz</h2>
            <p className="text-xs text-center mb-4 opacity-80">
              Crie seu usu√°rio ou escolha um j√° existente. Exporte/importe seu progresso quando quiser.
            </p>

            <div className="space-y-3">
              <div>
                <label className="text-xs opacity-80">Usu√°rio</label>
                <input
                  className="w-full mt-1 px-3 py-2 rounded-xl bg-white/10 outline-none text-sm"
                  value={user}
                  onChange={e=>setUser(e.target.value)}
                  placeholder="Ex.: DraMaria, EstudanteJo√£o..."
                />
              </div>

              <div className="flex gap-2">
                <button
                  onClick={handleEnter}
                  className="flex-1 px-3 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold"
                >
                  Entrar / Criar perfil
                </button>
                <button
                  onClick={handleExport}
                  className="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/20 text-xs"
                >
                  Exportar save
                </button>
              </div>

              <div className="mt-2 text-xs">
                <div className="mb-1">Importar save:</div>
                <input
                  type="file"
                  accept=".json"
                  onChange={e=>setFile(e.target.files[0]||null)}
                  className="text-xs"
                />
                <button
                  onClick={handleImport}
                  className="ml-2 px-3 py-1 rounded-xl bg-sky-500 hover:bg-sky-600 text-xs"
                >
                  Importar
                </button>
              </div>
            </div>

            {Object.keys(profiles).length>0 && (
              <div className="mt-4">
                <div className="text-xs mb-1 opacity-70">Perfis:</div>
                <div className="flex flex-wrap gap-2">
                  {Object.keys(profiles).map(p=>(
                    <button
                      key={p}
                      onClick={()=>setUser(p)}
                      className="px-3 py-1 rounded-full bg-white/10 hover:bg-white/20 text-xs"
                    >
                      {p}
                    </button>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    function CourtSelectScreen({onSelectCourt}){
      const courts = [
        {id:"criminal",icon:"‚öñÔ∏è",nome:"Criminal",desc:"Crimes contra a pessoa e o patrim√¥nio."},
        {id:"familia",icon:"üë®‚Äçüë©‚Äçüëß",nome:"Fam√≠lia",desc:"Guarda, pens√£o, div√≥rcio e medidas protetivas."},
        {id:"trabalhista",icon:"üíº",nome:"Trabalhista",desc:"V√≠nculo, verbas, jornada e danos morais."}
      ];
      return (
        <div className="min-h-screen bg-black flex items-center justify-center text-white">
          <div className="max-w-4xl w-full mx-4 p-6">
            <h2 className="text-3xl font-bold mb-6 text-center">Escolha o Tribunal</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
              {courts.map(c=>(
                <button
                  key={c.id}
                  onClick={()=>onSelectCourt(c.id)}
                  className="p-5 rounded-3xl bg-white/10 border border-white/15 hover:bg-white/20 transition text-left"
                >
                  <div className="text-3xl mb-2">{c.icon}</div>
                  <div className="text-lg font-semibold">{c.nome}</div>
                  <p className="text-xs opacity-80 mt-1">{c.desc}</p>
                </button>
              ))}
            </div>
          </div>
        </div>
      );
    }

    function LocationSelect({profile,onSelectLocation}){
      const [estado,setEstado] = useState(profile.estado||"SP");
      const cidades = ESTADOS[estado] || [];
      const [cidade,setCidade] = useState(profile.cidade||cidades[0]||"");

      return (
        <div className="min-h-screen bg-black text-white flex items-center justify-center">
          <div className="bg-white/10 p-6 rounded-3xl max-w-md w-full mx-4 border border-white/10">
            <h2 className="text-2xl font-bold mb-4">Escolha a comarca</h2>
            <div className="mb-3">
              <label className="text-xs opacity-80">Estado</label>
              <select
                value={estado}
                onChange={e=>{
                  const uf = e.target.value;
                  setEstado(uf);
                  const lista = ESTADOS[uf]||[];
                  setCidade(lista[0]||"");
                }}
                className="w-full mt-1 px-3 py-2 bg-white/10 rounded-xl outline-none text-sm"
              >
                {Object.keys(ESTADOS).map(uf=>(
                  <option key={uf} value={uf}>{uf}</option>
                ))}
              </select>
            </div>
            <div className="mb-4">
              <label className="text-xs opacity-80">Cidade</label>
              <select
                value={cidade}
                onChange={e=>setCidade(e.target.value)}
                className="w-full mt-1 px-3 py-2 bg-white/10 rounded-xl outline-none text-sm"
              >
                {(ESTADOS[estado]||[]).map(c=>(
                  <option key={c} value={c}>{c}</option>
                ))}
              </select>
            </div>
            <button
              onClick={()=>onSelectLocation(estado,cidade)}
              className="w-full px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold"
            >
              Confirmar
            </button>
          </div>
        </div>
      );
    }

    function ProvaViewer({prova,onClose}){
      if(!prova) return null;
      return (
        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-40">
          <div className="bg-slate-900 border border-white/15 rounded-3xl max-w-lg w-full mx-4 p-6">
            <h3 className="text-lg font-semibold mb-2">{prova.id} ‚Äî {prova.tipo}</h3>
            <p className="text-sm whitespace-pre-wrap opacity-90 mb-4">{prova.conteudo}</p>
            <button
              onClick={onClose}
              className="px-4 py-2 rounded-xl bg-red-500 hover:bg-red-600 text-sm font-semibold"
            >
              Fechar
            </button>
          </div>
        </div>
      );
    }

    function Escritorio({profile,cases,onSelectCase,onRelatorio,sons}){
      const fila = cases.filter(c=>c.status==="na_fila");
      return (
        <div className="min-h-screen relative bg-[url('escritorio.jpg')] bg-cover bg-center text-white">
          <div className="absolute inset-0 bg-black/65 backdrop-blur-sm"></div>
          <div className="relative z-10 max-w-6xl mx-auto p-6">
            <div className="flex items-center justify-between mb-4">
              <div>
                <h1 className="text-2xl font-bold">Escrit√≥rio do Juiz</h1>
                <p className="text-xs opacity-80">
                  {profile.nome} ‚Äî {profile.cidade}/{profile.estado} ‚Ä¢ {profile.court||"sem tribunal"}
                </p>
              </div>
              <div className="text-xs text-right opacity-80">
                Julgados: {profile.stats?.julgados||0}<br/>
                Acertos: {profile.stats?.acertos||0}<br/>
                Prest√≠gio: {profile.
